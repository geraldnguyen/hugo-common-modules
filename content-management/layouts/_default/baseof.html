<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ if .Title }}{{ .Title }} - {{ end }}{{ .Site.Title }}</title>
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">

    <!-- Site favicon: uses the SVG logo in static/ -->
    <link rel="icon" href="{{ "logo.svg" | relURL }}" type="image/svg+xml">
    <!-- Optional PNG fallback for older browsers: place a 32x32 png at static/favicon-32.png and uncomment the line below -->
    <!-- <link rel="icon" href="{{ "favicon-32.png" | relURL }}" sizes="32x32" type="image/png"> -->
    <!-- Apple touch icon (iOS) - recommended 180x180 PNG at static/apple-touch-icon.png -->
    <!-- Place a PNG at static/apple-touch-icon.png and uncomment the line below to enable -->
    <!-- <link rel="apple-touch-icon" sizes="180x180" href="{{ "apple-touch-icon.png" | relURL }}"> -->
    <!-- Windows tile (mstile) - recommended 150x150 PNG at static/mstile-150x150.png -->
    <!-- Add these meta tags and place files at the given paths to enable Windows tile support -->
    <!--
    <meta name="msapplication-TileColor" content="#ffd54a">
    <meta name="msapplication-TileImage" content="{{ "mstile-150x150.png" | relURL }}">
    -->

    <!-- Open Graph / Facebook -->
    {{ partial "opengraph.html" . }}

    <!-- Google google_analytics -->
    {{ partial "google_analytics.html" . }}

    <!-- Google AdSense -->
    {{ partial "google_adsense.html" . }}
    
    <!-- Fonts -->
    {{ partial "google_font.html" . }}

    <!-- Head verification tags (Pinterest, etc.) -->
    {{ partial "html_head_verify.html" . }}
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ "css/base.css" | absURL }}">
    <link rel="stylesheet" href="{{ "css/style.css" | absURL }}">

    <style>
    /* Dropdown submenu: hidden by default, shown on hover */
    .nav-menu { position: relative; }
    .nav-item { position: relative; display: inline-block; }
    .nav-item.has-children > .nav-submenu {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #fff;
        min-width: 12rem;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        border-radius: 6px;
        padding: 0.4rem 0.2rem;
        z-index: 1000;
    }
    /* Show submenu on hover (desktop-only: larger screens & hover-capable devices) */
    @media (hover: hover) and (min-width: 769px) {
        .nav-item.has-children:hover > .nav-submenu {
            display: block;
        }
    }
    .nav-submenu .nav-sublink {
        display: block;
        padding: 0.45rem 1rem;
        color: inherit;
        text-decoration: none;
        white-space: nowrap;
    }
    .nav-submenu .nav-sublink:hover {
        background: #f6f9ff;
    }
    /* Keep base layout unchanged on small screens - mobile can use the existing toggle */
    @media (max-width: 768px) {
        .nav-item { display: block; }
        .nav-item.has-children > .nav-submenu { position: static; display: none; }
        .nav-item.has-children.open > .nav-submenu { display: block; }
    }
    </style>

    {{ partial "html_head.html" . }}


</head>
<body>
    
    <header class="site-header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    {{ partial "nav-social.html" . }}
                    
                    <a href="{{ .Site.BaseURL }}" class="nav-brand">
                        <h1>{{ .Site.Title }}</h1>
                    </a>
                </div>

                <nav class="nav-menu">
                    {{- range .Site.Menus.main }}
                        <div class="nav-item{{ if gt (len .Children) 0 }} has-children{{ end }}">
                            <a href="{{ .URL }}" class="nav-link {{ if $.IsMenuCurrent "main" . }}active{{ end }}">{{ .Name }}</a>
                            {{- if gt (len .Children) 0 }}
                                <div class="nav-submenu">
                                    {{- range .Children }}
                                        {{ if hasPrefix .URL "http" }}
                                            <a href="{{ .URL }}" target="_blank" rel="noopener noreferrer" class="nav-link nav-sublink {{ if $.IsMenuCurrent "main" . }}active{{ end }}">{{ .Name }}</a>
                                        {{ else }}
                                            <a href="{{ .URL }}" class="nav-link nav-sublink {{ if $.IsMenuCurrent "main" . }}active{{ end }}">{{ .Name }}</a>
                                        {{ end }}
                                    {{- end }}
                                </div>
                            {{- end }}
                        </div>
                    {{- end }}
                </nav>
                <div class="nav-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        {{ block "main" . }}{{ end }}
    </main>

    <footer class="site-footer">
        <div class="footer-container">
            <p>&copy; {{ now.Year }} {{ .Site.Title }}. {{ .Site.Params.Description}}.</p>
            <div class="footer-links">
                {{- range .Site.Menus.footer -}}
                    <a href="{{ .URL }}" class="footer-link {{ if $.IsMenuCurrent "footer" . }}active{{ end }}">{{ .Name }}</a>
                {{- end -}}
            </div>

            <!-- Social icons (configured in site params -> social) -->
            <div class="footer-social">
                {{ partial "nav-social.html" . }}
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="{{ "js/main.js" | absURL }}"></script>
    <script src="{{ "js/base.js" | absURL }}"></script>

        <script>
        // Mobile: expand/collapse submenu when tapping the parent menu item.
        (function(){
            const mq = window.matchMedia('(max-width: 768px)');

            function closeAllExcept(el){
                document.querySelectorAll('.nav-item.has-children.open').forEach(item=>{
                    if(item !== el){
                        item.classList.remove('open');
                        const l = item.querySelector(':scope > a.nav-link'); if(l) l.setAttribute('aria-expanded','false');
                    }
                });
            }

            function initMobileSubmenu(){
                document.querySelectorAll('.nav-item.has-children').forEach(item=>{
                    const link = item.querySelector(':scope > a.nav-link');
                    if(!link) return;
                    link.setAttribute('aria-haspopup','true');
                    link.setAttribute('aria-expanded', item.classList.contains('open') ? 'true' : 'false');

                    // Remove any previous handler to avoid double-binding when this script runs again
                    link.onclick = function(e){
                        if(mq.matches){
                            e.preventDefault();
                            const wasOpen = item.classList.contains('open');
                            if(!wasOpen){
                                closeAllExcept(item);
                                item.classList.add('open');
                                link.setAttribute('aria-expanded','true');
                            } else {
                                item.classList.remove('open');
                                link.setAttribute('aria-expanded','false');
                            }
                        }
                        // On desktop clicks behave normally (hover/links)
                    };
                });
            }

            document.addEventListener('DOMContentLoaded', initMobileSubmenu);

            // Close open submenus when switching to desktop sizes
            window.addEventListener('resize', function(){
                if(!mq.matches){
                    document.querySelectorAll('.nav-item.has-children.open').forEach(item=>{
                        item.classList.remove('open');
                        const l = item.querySelector(':scope > a.nav-link'); if(l) l.setAttribute('aria-expanded','false');
                    });
                }
            });

            // Close submenus when clicking outside nav on mobile
            document.addEventListener('click', function(e){
                if(!mq.matches) return;
                if(!e.target.closest('.nav-container')){
                    document.querySelectorAll('.nav-item.has-children.open').forEach(item=>{
                        item.classList.remove('open');
                        const l = item.querySelector(':scope > a.nav-link'); if(l) l.setAttribute('aria-expanded','false');
                    });
                }
            });
        })();
        </script>

</body>
</html>
